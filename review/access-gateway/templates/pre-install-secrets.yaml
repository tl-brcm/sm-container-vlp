---
{{- if and .Values.global.registry.credentials.username ( not .Values.global.registry.existingSecrets ) }}
# Credentials for private registry
kind: Secret
apiVersion: v1
metadata:
  name: {{ .Release.Name }}-siteminder-registry-key
  namespace: {{ .Release.Namespace }}
  labels:
    release: {{ .Release.Name }}
type: kubernetes.io/dockerconfigjson
data:
  .dockerconfigjson: {{ template "imagePullSecret" . }}
{{- end }}
---
# Secrets for CA Single Sign-On
kind: Secret
apiVersion: v1
metadata:
  name: {{ .Release.Name }}-siteminder-{{ .Values.sso.accessGateway.regSecret.name }}
  namespace: {{ .Release.Namespace }}
  labels:
    release: {{ .Release.Name }}
    app: {{ template "fullname" . }}
type: Opaque
data:
  adminUsername: {{ .Values.sso.adminUsername }}
  adminPassword: {{ .Values.sso.adminPassword }}
---
# Secrets for AG apache ssl configuration
{{- if and .Values.sso.accessGateway.apache.ssl.enabled }}
kind: Secret
apiVersion: v1
metadata:
  name: {{ .Release.Name }}-siteminder-{{ .Values.sso.accessGateway.apache.ssl.creds }}
  namespace: {{ .Release.Namespace }}
  labels:
    release: {{ .Release.Name }}
    app: {{ template "fullname" . }}
type: Opaque
data:
  keypwd: "{{ .Values.sso.accessGateway.apache.ssl.keyPwd }}"
{{ end }}
---
# Secrets for AG noodle client ssl configuration
{{- if and .Values.sso.accessGateway.noodle.ssl.enabled }}
kind: Secret
apiVersion: v1
metadata:
  name: {{ .Release.Name }}-siteminder-{{ .Values.sso.accessGateway.noodle.ssl.creds }}
  namespace: {{ .Release.Namespace }}
  labels:
    release: {{ .Release.Name }}
    app: {{ template "fullname" . }}
type: Opaque
data:
  clientpassphrase: {{ .Values.sso.accessGateway.noodle.ssl.clientPassphrase }}
{{ end }}
---
# Secrets for CA Single Sign-On awsS3 Startup Configuration Repository 
{{ if and .Values.sso.configuration.type (eq .Values.sso.configuration.type "awsS3") }}
kind: Secret
apiVersion: v1
metadata:
  name: {{ .Release.Name }}-siteminder-{{ .Values.sso.configuration.aws.creds }}
  namespace: {{ .Release.Namespace }}
  labels:
    release: {{ .Release.Name }}
    app: {{ template "fullname" . }}
type: Opaque
data:
  {{- if .Values.sso.configuration.aws.keyID }}
  awskeyid: {{ .Values.sso.configuration.aws.keyID }}
  {{- else }}
  awskeyid: ""
  {{- end }} 
  {{- if .Values.sso.configuration.aws.accessKey }}
  awssecretaccesskey: {{ .Values.sso.configuration.aws.accessKey }}
  {{- else }}
  awssecretaccesskey: ""
  {{- end }} 
{{ end }}
---
# Secrets for CA Single Sign-On awsS3 Runtime Configuration Repository 
{{- if and .Values.sso.runtime.configuration.enabled }}
{{ if and .Values.sso.runtime.configuration.type (eq .Values.sso.runtime.configuration.type "awsS3") }}
kind: Secret
apiVersion: v1
metadata:
  name: {{ .Release.Name }}-siteminder-{{ .Values.sso.runtime.configuration.aws.creds }}
  namespace: {{ .Release.Namespace }}
  labels:
    release: {{ .Release.Name }}
    app: {{ template "fullname" . }}
type: Opaque
data:
  {{- if .Values.sso.runtime.configuration.aws.keyID }}
  runtimeawskeyid: {{ .Values.sso.runtime.configuration.aws.keyID }}
  {{- else }}
  runtimeawskeyid: ""
  {{- end }}
  {{- if .Values.sso.runtime.configuration.aws.accessKey }}
  runtimeawssecretaccesskey: {{ .Values.sso.runtime.configuration.aws.accessKey }}
  {{- else }}
  runtimeawssecretaccesskey: ""
  {{- end }}
{{ end }}
{{ end }}
---
# Secrets for CA Single Sign-On GITHUB Startup Configuration Repository 
{{ if and .Values.sso.configuration.type (eq .Values.sso.configuration.type "git") }}
kind: Secret
apiVersion: v1
metadata:
  name: {{ .Release.Name }}-siteminder-{{ .Values.sso.configuration.git.creds }}
  namespace: {{ .Release.Namespace }}
  labels:
    release: {{ .Release.Name }}
    app: {{ template "fullname" . }}
type: Opaque
data:
  githubAccessToken: {{ .Values.sso.configuration.git.accessToken }}
{{ end }}
---
# Secrets for CA Single Sign-On GITHUB Runtime Configuration Repository 
{{- if and .Values.sso.runtime.configuration.enabled }}
{{ if and .Values.sso.runtime.configuration.type (eq .Values.sso.runtime.configuration.type "git") }}
kind: Secret
apiVersion: v1
metadata:
  name: {{ .Release.Name }}-siteminder-{{ .Values.sso.runtime.configuration.git.creds }}
  namespace: {{ .Release.Namespace }}
  labels:
    release: {{ .Release.Name }}
    app: {{ template "fullname" . }}
type: Opaque
data:
  gitRuntimeAccessToken: {{ .Values.sso.runtime.configuration.git.accessToken }}
{{ end }}
{{ end }}
---
# Secrets for CA Single Sign-On MasterKey Seed
kind: Secret
apiVersion: v1
metadata:
  name: {{ .Release.Name }}-siteminder-keycreds
  namespace: {{ .Release.Namespace }}
  labels:
    release: {{ .Release.Name }}
    app: {{ template "fullname" . }}
type: Opaque
data:
  masterKeySeed: {{ .Values.global.keySeed }}
---
# Secrets for troubleshooting data to cloud storage
{{- if and .Values.sso.accessGateway.troubleshootingData.enabled }}
kind: Secret
apiVersion: v1
metadata:
  name: {{ .Release.Name }}-siteminder-{{ .Values.sso.accessGateway.troubleshootingData.creds }}
  namespace: {{ .Release.Namespace }}
  labels:
    release: {{ .Release.Name }}
    app: {{ template "fullname" . }}
type: Opaque
data:
{{ if and .Values.sso.accessGateway.troubleshootingData.storageType (eq .Values.sso.accessGateway.troubleshootingData.storageType "awsS3") }}
  {{- if .Values.sso.accessGateway.troubleshootingData.aws.keyID }}
  agTroubleshootDataAwsAccessKeyId: {{ .Values.sso.accessGateway.troubleshootingData.aws.keyID }}
  {{- else }}
  agTroubleshootDataAwsAccessKeyId: ""
  {{- end }}

  {{- if .Values.sso.accessGateway.troubleshootingData.aws.accessKey }}
  agTroubleshootDataAwsSecretAccessKey: {{ .Values.sso.accessGateway.troubleshootingData.aws.accessKey }}
  {{- else }}
  agTroubleshootDataAwsSecretAccessKey: ""
  {{- end }}
{{ end }}
{{ if and .Values.sso.accessGateway.troubleshootingData.storageType (eq .Values.sso.accessGateway.troubleshootingData.storageType "azureFileShares") }}
  agTroubleshootDataAzureSASToken: {{ .Values.sso.accessGateway.troubleshootingData.azure.sasToken }}
{{ end }}
{{ end }}
